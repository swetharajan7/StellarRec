<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>StellarRec - One upload. Unlimited reach.</title>

  <!-- Fonts & Icons -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

  <!-- Styles -->
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family:'Roboto',sans-serif;
      background:linear-gradient(135deg,var(--bg-grad-1,#f8f9fa) 0%,var(--bg-grad-2,#e9ecef) 100%);
      color:var(--text,#333);
      min-height:100vh;
    }
    /* Header */
    .header {
      background:linear-gradient(135deg,#1976d2 0%,#7c4dff 100%);
      color:#fff; padding:1.1rem 2rem;
      box-shadow:0 4px 20px rgba(25,118,210,0.3);
    }
    .header-content {
      max-width:1200px; margin:0 auto;
      display:flex; justify-content:space-between; align-items:center; gap:1rem;
    }
    .logo {
      display:flex; align-items:center; gap:.5rem;
      font-size:1.8rem; font-weight:700;
      text-decoration:none; color:#fff; transition:.3s;
    }
    .logo:hover { opacity:.85; transform:translateY(-1px); }
    /* Header nav */
    .header-nav { display:flex; justify-content:space-between; align-items:center; gap:1rem; flex:1; margin:0 1rem; }
    .nav-left, .nav-right { display:flex; gap:1.25rem; align-items:center; }
    [hidden] { display:none!important; }
    /* Tabs */
    .header-nav .nav-link {
      cursor:pointer; padding:.5rem 1rem; border-radius:6px;
      text-decoration:none; color:#fff; font-weight:500;
      transition:background .2s;
    }
    .header-nav .nav-link[aria-selected="true"] { background:rgba(255,255,255,0.2); }
    .header-nav .nav-link:hover { background:rgba(255,255,255,0.15); }
    /* Sections */
    .section-title {
      font-size:1.4rem; font-weight:600; margin-bottom:.75rem;
      display:flex; align-items:center; gap:.5rem; color:#333;
    }
    .section-title .material-icons { font-size:1.4rem; color:#1976d2; }

    .container { max-width:1200px; margin:1rem auto; padding:0 1rem; }

    /* Upload + Video grid */
    .compose-grid {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(300px,1fr));
      gap:1.5rem;
    }

    .upload-section, .video-section, .writer-section, .selected-section {
      background:#fff; border-radius:12px; padding:1.25rem;
      box-shadow:0 4px 12px rgba(0,0,0,0.08);
    }

    .writer-section { grid-column:1 / -1; }

    /* File upload */
    .upload-box {
      border:2px dashed #ccc; border-radius:12px;
      padding:1rem; text-align:center; cursor:pointer;
      transition:border-color .3s, background .3s;
    }
    .upload-box.dragover { border-color:#1976d2; background:rgba(25,118,210,.05); }
    .upload-box input { display:none; }
    .uploaded-file { display:none; margin-top:1rem; font-size:.9rem; color:#555; }

    /* Video upload */
    .video-upload { text-align:center; }
    .video-upload input { margin-top:.5rem; }

    /* Selected Universities */
    .selected-list { list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:.5rem; }
    .selected-item {
      display:flex; justify-content:space-between; align-items:center;
      background:#f1f5f9; padding:.5rem .75rem; border-radius:8px;
      font-size:.95rem;
    }
    .remove-btn {
      background:none; border:none; color:#e11d48; font-size:1.2rem; cursor:pointer;
    }

    /* Student + Recommender Panels */
    #panel-recommender, #panel-student { margin-top:1rem; }
  </style>
</head>
<body>
  <!-- Header -->
  <div class="header">
    <div class="header-content">
      <a href="/" class="logo"><span class="material-icons">star</span>StellarRec</a>
      <nav class="header-nav">
        <div class="nav-left">
          <a href="#student" class="nav-link" data-view="student" id="hdrStuTab">Student</a>
        </div>
        <div class="nav-right">
          <a href="#recommender" class="nav-link" data-view="recommender" id="hdrRecTab">Recommender</a>
        </div>
      </nav>
      <button id="headerThemeBtn" class="material-icons">brightness_6</button>
    </div>
  </div>
  <!-- ================= Recommender Panel ================= -->
  <div class="container" id="panel-recommender" hidden>
    <h2 class="section-title"><span class="material-icons">school</span> Recommender View</h2>

    <div class="compose-grid">
      <!-- Upload PDF -->
      <div class="upload-section">
        <h3 class="section-title"><span class="material-icons">upload_file</span> Upload Recommendation PDF</h3>
        <div id="uploadArea" class="upload-box">
          <p>Drag & drop a PDF here or <button id="chooseFileBtn">Choose File</button></p>
          <input type="file" id="fileInput" accept="application/pdf"/>
        </div>
        <div class="uploaded-file" id="uploadedFile">
          <p><strong>File:</strong> <span id="fileName"></span></p>
          <p><span id="fileSize"></span></p>
          <button id="removeFileBtn">Remove</button>
        </div>
      </div>

      <!-- Upload Video -->
      <div class="video-section">
        <h3 class="section-title"><span class="material-icons">videocam</span> Upload Video</h3>
        <div class="video-upload">
          <input type="file" id="videoInput" accept="video/*"/>
          <p style="font-size:.9rem; color:#555;">(Optional) Attach a short intro video.</p>
        </div>
      </div>

      <!-- Write Letter -->
      <div class="writer-section" id="writerSection" style="grid-column:1 / -1;">
        <h3 class="section-title"><span class="material-icons">edit</span> Write Letter</h3>
        <textarea id="letterText" rows="6" style="width:100%; padding:.5rem; border-radius:8px; border:1px solid #ccc;"></textarea>
        <button id="sendBtn" style="margin-top:.75rem; padding:.6rem 1.2rem; background:#1976d2; color:#fff; border:none; border-radius:8px; cursor:pointer;">Send</button>
      </div>
    </div>

    <!-- Selected Universities (ONLY in Recommender view now) -->
    <div class="selected-section">
      <h3 class="section-title"><span class="material-icons">check_circle</span> Selected Universities</h3>
      <ul class="selected-list" id="selectedList"></ul>
    </div>
  </div>
  <!-- ================= Student Panel ================= -->
  <div class="container" id="panel-student">
    <h2 class="section-title"><span class="material-icons">person</span> Student View</h2>

    <!-- Tabs for Student -->
    <nav class="header-nav" style="margin:1rem 0;">
      <a href="#send" class="nav-link" id="stuTabSend" aria-selected="true">Send Request</a>
      <a href="#track" class="nav-link" id="stuTabTrack" aria-selected="false">Track Requests</a>
    </nav>

    <!-- Send Request Form -->
    <div id="stuPanelSend">
      <form id="stuSendForm">
        <div style="display:grid; gap:1rem; grid-template-columns:repeat(auto-fit,minmax(240px,1fr));">
          <div>
            <label>Student Name</label>
            <input id="stuName" type="text" required style="width:100%; padding:.5rem; border:1px solid #ccc; border-radius:6px;"/>
          </div>
          <div>
            <label>Student Email</label>
            <input id="stuEmail" type="email" required style="width:100%; padding:.5rem; border:1px solid #ccc; border-radius:6px;"/>
          </div>
          <div>
            <label>Recommender Name</label>
            <input id="recName" type="text" required style="width:100%; padding:.5rem; border:1px solid #ccc; border-radius:6px;"/>
          </div>
          <div>
            <label>Recommender Email</label>
            <input id="recEmail" type="email" required style="width:100%; padding:.5rem; border:1px solid #ccc; border-radius:6px;"/>
          </div>
        </div>
        <button type="submit" style="margin-top:1rem; padding:.6rem 1.2rem; background:#1976d2; color:#fff; border:none; border-radius:8px; cursor:pointer;">Send Request</button>
      </form>
    </div>

    <!-- Track Requests -->
    <div id="stuPanelTrack" hidden>
      <h3 class="section-title"><span class="material-icons">timeline</span> Track Requests</h3>
      <table style="width:100%; border-collapse:collapse; margin-top:1rem;">
        <thead>
          <tr style="background:#f1f5f9; text-align:left;">
            <th style="padding:.5rem;">Recommender</th>
            <th style="padding:.5rem;">Email</th>
            <th style="padding:.5rem;">Date</th>
            <th style="padding:.5rem;">Status</th>
          </tr>
        </thead>
        <tbody id="stuTrackBody"></tbody>
      </table>
    </div>

    <!-- Select Universities (moved here from Recommender) -->
    <div class="selected-section" style="margin-top:2rem;">
      <h3 class="section-title"><span class="material-icons">school</span> Select Universities</h3>
      <input type="text" id="searchBox" placeholder="Search universities..." style="width:100%; padding:.5rem; border:1px solid #ccc; border-radius:6px;"/>
      <ul class="selected-list" id="searchResults"></ul>
    </div>
  </div>
  <!-- ================= Scripts ================= -->
  <script src="assets/js/fuse.min.js"></script>
  <script src="assets/js/localforage.min.js"></script>
  <script src="assets/js/dashboard.js"></script>

  <!-- View Switcher (Student <-> Recommender) -->
  <script>
  (function(){
    const studentPanel = document.getElementById('panel-student');
    const recPanel     = document.getElementById('panel-recommender');
    const toggles      = document.querySelectorAll('.header-nav .nav-link');

    if (!studentPanel || !recPanel || !toggles.length) return;

    // Safe localStorage helpers
    const safeLS = {
      get(k, d){ try { return localStorage.getItem(k) ?? d; } catch(e){ return d; } },
      set(k, v){ try { localStorage.setItem(k, v); } catch(e){} }
    };

    function setActive(view){
      const isStudent = (view === 'student');
      studentPanel.hidden = !isStudent;
      recPanel.hidden     =  isStudent;
      studentPanel.style.display = isStudent ? '' : 'none';
      recPanel.style.display     = isStudent ? 'none' : '';

      toggles.forEach(btn => {
        const on = btn.dataset.view === view;
        btn.setAttribute('aria-selected', on ? 'true' : 'false');
        if (on) btn.setAttribute('aria-current','page'); else btn.removeAttribute('aria-current');
      });

      history.replaceState(null, '', '#' + view);
      safeLS.set('sr_current_view', view);
    }

    toggles.forEach(btn => btn.addEventListener('click', () => setActive(btn.dataset.view)));

    const fromHash = (location.hash || '').replace('#','');
    const saved    = safeLS.get('sr_current_view', '');
    const initial  = (fromHash === 'recommender' || fromHash === 'student') ? fromHash
                  : (saved === 'recommender' || saved === 'student') ? saved
                  : 'student';
    setActive(initial);

    window.addEventListener('hashchange', () => {
      const v = (location.hash || '#student').slice(1);
      setActive(v === 'recommender' ? 'recommender' : 'student');
    });
  })();
  </script>
</body>
</html>



